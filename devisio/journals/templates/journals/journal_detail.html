{% extends parent %}

{% load fb_versions %}
{% load compress %}

{% block content %}
<div class="row">
  <div class="twelve columns">
    <div class="page-header">
      <h2>{{journal.name}} <small>{{journal.start_datetime|date}} to {{journal.end_datetime|date}}</small></h2>
    </div>
  </div>
</div>
<div class="row">
  <div class="twelve columns">
    {{journal.description|linebreaks}}
  </div>
</div>
<div class="row">
  <div class="twelve columns" style="margin-bottom: 50px;">
    <div id="map-canvas" style="width: 100%; height: 200px;"></div>
  </div>
</div>
<div class="row">
  <div class="twelve columns">
    {% for entry in journal.entries.all %}
    <h3>{{entry.headline}} <small>{{entry.datetime|date}}</small></h3>
    <p>{{entry.text}}</p>
    <div style="text-align: center; margin: 25px 0 50px 0;">
      {% for photo in entry.photos.all %}
      <img src="{% version photo.image 'avatar' %}" class="avatar" style="margin: 0 10px;">
      {% endfor %}
    </div>
    {% endfor %}
  </div>
</div>
{% endblock %}

{% block js %}
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?v=3.13&key=AIzaSyAPF9Px1e0Tz5TOh-TdcUFtBFLG1CmDzIc&sensor=false"></script>
{% compress js %}
<script src="{{STATIC_URL}}coffeescripts/maps-api.coffee" type="text/coffeescript"></script>
<script type="text/coffeescript">
  @journals = [
  {% for entry in journal.entries.all %}  {'location': [{{entry.location}}], 'slug': '{{entry.id}}'},
  {% endfor %}]

  $('#pjax-container').on 'pjax:end', () ->
    initializeMaps()

  google.maps.event.addDomListener window, 'load', initializeMaps
</script>
{% endcompress %}
{% endblock %}
