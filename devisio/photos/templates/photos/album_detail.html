{% extends parent %}

{% load compress %}
{% load fb_versions %}
{% load absurl %}

{% block og-url %}{% absurl 'photos:detail' album.slug %}{% endblock %}
{% block og-image %}{% version album.photos.all.0.image 'album-bubble' %}{% endblock %}

{% block content %}
<div id="photoviewer">
  <div class="gallery">
    <img src="" class="photo" alt="" title="Click to show next photo." />
  </div>
  <div class="actions">
    <a class="share" href="https://plus.google.com/share?url={% absurl 'photos:detail' album.slug %}" target="_blank" title="Share on Google+"><i class="icon-google-plus"></i></a>
    <a class="share" href="https://www.facebook.com/sharer/sharer.php?u={% absurl 'photos:detail' album.slug %}" target="_blank" title="Share on Facebook"><i class="icon-facebook"></i></a>
    <a class="fullscreen" title="Toggle fullscreen"><i class="icon-fullscreen"></i></a>
  </div>
  <div class="navigation">
    <a class="prev" title="Previous photo"><i class="icon-chevron-left"></i></a>
    <a class="next" title="Next photo"><i class="icon-chevron-right"></i></a>
  </div>
</div>
{% compress js %}
<script type="text/coffeescript">
updatePhotoUrl = (element, pos) ->
  link = element.attr 'href'
  parts = link.split('#')
  element.attr 'href', parts[0] + '#' + pos

jQuery(document).ready () ->
  viewer = new document.PhotoViewer('{{json|safe}}')
  $(viewer).on 'photoChange', (evt) ->
      updatePhotoUrl $(element), viewer.pos for element in $('#photoviewer > .actions > a.share')
</script>
{% endcompress %}
{% endblock %}
